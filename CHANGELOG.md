# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]
### Added
- Страница реализаций с автоматическим формированием начислений по спецификациям.
- Модальные формы редактирования и удаления для контрагентов, объектов, договоров, спецификаций и реализаций.
- Валидация дат услуг в рамках диапазона дат спецификации с информативными сообщениями об ошибках.
- Сохранение введённых данных формы при ошибке валидации (форма не очищается, пользователь может исправить ошибки).
- Создание разовой реализации через модальное окно с привязкой к договору/спецификации и добавлением услуги.
- Расширенная таблица реализаций с колонками: тип услуги, объект, договор/спецификация.
- Частичное редактирование автоматических реализаций (разрешено изменять дату, расходы и описание).
- Полное редактирование разовых реализаций (все поля доступны для изменения).
- Унифицированный современный дизайн всех страниц (контрагенты, объекты, договоры, реализации).
- Адаптивные таблицы без принудительной прокрутки (колонки адаптируются под контент).
- Детальный план реализации системы учета оплат (см. `docs/PAYMENT_SYSTEM_PLAN.md`).
- **Система учета платежей:**
  - Модель `Payment` с таблицей связи `payment_realization_association` для распределения платежей на реализации.
  - Поле `paid_amount` в модели `Realization` для отслеживания суммы оплаты.
  - Автоматическое определение статуса оплаты (`NOT_PAID`, `PARTIALLY_PAID`, `PAID`) на основе `paid_amount`.
  - Страница `/payments` со списком платежей и формой добавления.
  - Возможность сразу распределить платеж на выбранные реализации при создании.
  - Динамический выбор неоплаченных реализаций в модальном окне (фильтрация по контрагенту).
  - Редактирование платежей (дата, контрагент, договор, тип) без изменения суммы и распределения.
  - Удаление платежей с автоматическим откатом всех распределений на реализации.
### Changed
- Единый европейский формат дат (dd/mm/yyyy) во всех формах и списках.
- Удалено поле `payment_type` из модели `Realization` (будет использоваться в модели `Payment`).
- Статус оплаты теперь всегда устанавливается в "Не оплачено" для новых реализаций (будет определяться автоматически из платежей).
- Улучшена визуальная типографика: таблицы с hover-эффектами, иконки на кнопках, скругленные углы, тени.
- Таблицы используют всю доступную ширину страницы (убраны фиксированные размеры колонок).
### Fixed
- Исправлен циклический импорт между `app.py` и `models.py` (db теперь инициализируется в `models.py`).

## [0.1.0] - 2025-10-28
### Added
- Начальная настройка проекта: Flask, SQLAlchemy, структура папок.
- Модели базы данных для всех справочников (Контрагенты, Объекты, и т.д.).
- Модели для Договоров и Спецификаций.
- Базовый UI для управления Контрагентами, Объектами и Договорами.
- Возможность добавлять Спецификации на странице договора.
- Система ведения версий (`CHANGELOG.md`) и правила работы в Git.
