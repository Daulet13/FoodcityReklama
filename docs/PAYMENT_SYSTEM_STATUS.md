# –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã —É—á—ë—Ç–∞ –ø–ª–∞—Ç–µ–∂–µ–π

**–î–∞—Ç–∞:** 30 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –µ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –Ω–µ—Ä–µ—à—ë–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

---

## ‚úÖ –ß–¢–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –†–ê–ë–û–¢–ê–ï–¢

### 1. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (models.py)
- ‚úÖ **–ú–æ–¥–µ–ª—å `Payment`** —Å–æ–∑–¥–∞–Ω–∞ —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏:
  - `id`, `date`, `initial_amount`, `unallocated_amount`
  - `payment_type` (CASH / NON_CASH)
  - `counterparty_id`, `contract_id` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - Relationships –∫ `Counterparty`, `Contract`, `Realization`

- ‚úÖ **–¢–∞–±–ª–∏—Ü–∞ —Å–≤—è–∑–∏ `payment_realization_association`**:
  - –ú–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º –º–µ–∂–¥—É `Payment` –∏ `Realization`
  - –•—Ä–∞–Ω–∏—Ç —Å—É–º–º—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π —Å–≤—è–∑–∏: `amount`

- ‚úÖ **–ú–æ–¥–µ–ª—å `Realization` —Ä–∞—Å—à–∏—Ä–µ–Ω–∞**:
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `paid_amount` (Decimal, default=0)
  - –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `payment_type` (–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ `Payment`)
  - –î–æ–±–∞–≤–ª–µ–Ω `@property debt_amount` ‚Äî —Ä–∞—Å—á—ë—Ç –æ—Å—Ç–∞—Ç–∫–∞ –¥–æ–ª–≥–∞
  - –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `update_payment_status()` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞:
    - `NOT_PAID` ‚Äî –µ—Å–ª–∏ `paid_amount == 0`
    - `PARTIALLY_PAID` ‚Äî –µ—Å–ª–∏ `0 < paid_amount < total_sale`
    - `PAID` ‚Äî –µ—Å–ª–∏ `paid_amount >= total_sale`

### 2. –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `5eac254326c8_add_payment_model_and_paid_amount_to_.py`
- ‚úÖ –£—á—Ç–µ–Ω—ã –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ SQLite (–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç ALTER COLUMN)
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ: `flask db upgrade`

### 3. –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/payments` (payments.html)
- ‚úÖ **–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π** –≤ —Ç–∞–±–ª–∏—Ü–µ:
  - –ö–æ–ª–æ–Ω–∫–∏: ‚Ññ, –î–∞—Ç–∞, –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç, –î–æ–≥–æ–≤–æ—Ä, –°—É–º–º–∞, –ê–≤–∞–Ω—Å (–Ω–µ—Ä–∞–∑–Ω–µ—Å—ë–Ω–Ω–∞—è —Å—É–º–º–∞), –¢–∏–ø –æ–ø–ª–∞—Ç—ã, –î–µ–π—Å—Ç–≤–∏—è
  - –ò–∫–æ–Ω–∫–∏ –¥–ª—è —Ç–∏–ø–∞ –æ–ø–ª–∞—Ç—ã (–ù–∞–ª–∏—á–Ω—ã–µ/–ë–µ–∑–Ω–∞–ª)
  - –ö–Ω–æ–ø–∫–∏ "–ò–∑–º–µ–Ω–∏—Ç—å" –∏ "–£–¥–∞–ª–∏—Ç—å" –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞

- ‚úÖ **–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ù–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂"**:
  - –ü–æ–ª—è: –î–∞—Ç–∞, –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç, –î–æ–≥–æ–≤–æ—Ä, –°—É–º–º–∞, –¢–∏–ø –æ–ø–ª–∞—Ç—ã
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É (—Ä–∞–±–æ—Ç–∞–µ—Ç)
  - –°–µ–∫—Ü–∏—è "–í—ã–±–æ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –¥–ª—è –æ–ø–ª–∞—Ç—ã" (HTML-—Ä–∞–∑–º–µ—Ç–∫–∞ –≥–æ—Ç–æ–≤–∞)

- ‚úÖ **–ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞:
  - –†–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –ø–æ–ª—è: –¥–∞—Ç–∞, –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç, –¥–æ–≥–æ–≤–æ—Ä, —Ç–∏–ø
  - –°—É–º–º–∞ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç—Å—è (–¥–ª—è –∑–∞—â–∏—Ç—ã —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏)
  - –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç

- ‚úÖ **–ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞:
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
  - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏

### 4. –ú–∞—Ä—à—Ä—É—Ç—ã –∏ –ª–æ–≥–∏–∫–∞ (app.py)

#### ‚úÖ –ú–∞—Ä—à—Ä—É—Ç `/payments` (GET + POST)
**–†–∞–±–æ—Ç–∞–µ—Ç:**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:
  - `payments` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π
  - `counterparties` ‚Äî –≤—Å–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã
  - `contracts` ‚Äî –≤—Å–µ –¥–æ–≥–æ–≤–æ—Ä—ã
  - `payment_types` ‚Äî —Å–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ –æ–ø–ª–∞—Ç—ã
  - `realizations_json` ‚Äî JSON —Å –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏ –ø–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º
  - `now` ‚Äî —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞

**–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ (form_type='create_payment'):**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π (–¥–∞—Ç–∞, –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç, –¥–æ–≥–æ–≤–æ—Ä, —Ç–∏–ø, —Å—É–º–º–∞)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –∏–∑ —Ñ–æ—Ä–º—ã (`realization_ids`)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —Å –Ω–∞—á–∞–ª—å–Ω–æ–π —Å—É–º–º–æ–π
- ‚úÖ **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
  - –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É
  - –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –µ—Å—Ç—å –¥–æ–ª–≥ (`debt_amount > 0`)
  - –†–∞—Å—á—ë—Ç —Å—É–º–º—ã –∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é: `min(–¥–æ–ª–≥, –æ—Å—Ç–∞—Ç–æ–∫_–ø–ª–∞—Ç–µ–∂–∞)`
  - –ó–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É —Å–≤—è–∑–∏ `payment_realization_association`
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `paid_amount` —É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
  - –í—ã–∑–æ–≤ `update_payment_status()` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
- ‚úÖ –†–∞—Å—á—ë—Ç –æ—Å—Ç–∞—Ç–∫–∞: `unallocated_amount = initial_amount - total_allocated`
- ‚úÖ Flash-—Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –∏ –∞–≤–∞–Ω—Å–µ

#### ‚úÖ –ú–∞—Ä—à—Ä—É—Ç `/update-payment/<id>` (POST)
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –ø–æ–ª–µ–π: –¥–∞—Ç–∞, –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç, –¥–æ–≥–æ–≤–æ—Ä, —Ç–∏–ø
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π
- –°—É–º–º–∞ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ù–ï –º–µ–Ω—è—é—Ç—Å—è (–∑–∞—â–∏—Ç–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏)
- Flash-—Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

#### ‚úÖ –ú–∞—Ä—à—Ä—É—Ç `/delete-payment/<id>` (POST)
- –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –∏–∑ `payment_realization_association`
- **–û—Ç–∫–∞—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π:**
  - –£–º–µ–Ω—å—à–µ–Ω–∏–µ `paid_amount` —É –∫–∞–∂–¥–æ–π —Å–≤—è–∑–∞–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
  - –í—ã–∑–æ–≤ `update_payment_status()` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
  - –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –∏–∑ —Ç–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–∏
- –£–¥–∞–ª–µ–Ω–∏–µ —Å–∞–º–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
- Flash-—Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏–∏

#### ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
```python
eligible_realizations = Realization.query.filter(
    Realization.payment_status != PaymentStatus.PAID
).order_by(Realization.date.asc()).all()

realizations_by_counterparty = {}
for realization in eligible_realizations:
    debt = realization.debt_amount
    if debt <= 0:
        continue
    realizations_by_counterparty.setdefault(realization.counterparty_id, []).append(realization)

realizations_payload = {}
for counterparty_id, items in realizations_by_counterparty.items():
    realizations_payload[str(counterparty_id)] = [
        {
            'id': item.id,
            'number': item.number,
            'date': item.date.strftime('%d/%m/%Y'),
            'contract_number': item.contract.number if item.contract else None,
            'specification_number': item.specification.number if item.specification else None,
            'total': float(item.total_sale),
            'paid': float(item.paid_amount or 0),
            'debt': float(item.debt_amount)
        }
        for item in items
    ]
```

### 5. –î–∏–∑–∞–π–Ω –∏ UX
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –¥–∏–∑–∞–π–Ω (–≤ —Å—Ç–∏–ª–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü)
- ‚úÖ –ò–∫–æ–Ω–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É
- ‚úÖ Hover-—ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ —Å—Ç—Ä–æ–∫–∞—Ö —Ç–∞–±–ª–∏—Ü—ã
- ‚úÖ Badges –¥–ª—è —Ç–∏–ø–æ–≤ –æ–ø–ª–∞—Ç—ã
- ‚úÖ Flash-—Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏

### 6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: `docs/PAYMENT_SYSTEM_PLAN.md`
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω `CHANGELOG.md` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Å–∏—Å—Ç–µ–º—ã –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω `README.md` (—É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø–ª–∞—Ç–µ–∂–∞—Ö –≤ –ø–ª–∞–Ω–µ)

### 7. Git-–∫–æ–º–º–∏—Ç—ã
- ‚úÖ `feat: Add payment edit and delete functionality`
- ‚úÖ `docs: Update CHANGELOG for payment system`

---

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ù–ï–†–ï–®–Å–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –ù–ï –û–¢–û–ë–†–ê–ñ–ê–ï–¢–°–Ø

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ "–ù–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂" –µ—Å—Ç—å —Å–µ–∫—Ü–∏—è "–í—ã–±–æ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –¥–ª—è –æ–ø–ª–∞—Ç—ã", –Ω–æ –æ–Ω–∞ –ù–ï –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞.

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ù–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂"
2. –í—ã–±–∏—Ä–∞–µ—Ç –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
3. –ü–æ–¥ –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ —Ñ–æ—Ä–º—ã –¥–æ–ª–∂–Ω–∞ **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–∏—Ç—å—Å—è** —Ç–∞–±–ª–∏—Ü–∞ —Å –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏ —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ—á–∞–µ—Ç —á–µ–∫–±–æ–∫—Å–∞–º–∏, –∫–∞–∫–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç —ç—Ç–∏–º –ø–ª–∞—Ç–µ–∂–æ–º
5. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è "–í—ã–±—Ä–∞–Ω–æ –∫ –æ–ø–ª–∞—Ç–µ: XXX —Ä—É–±." –∏ "–û—Å—Ç–∞—Ç–æ–∫ –ø–ª–∞—Ç–µ–∂–∞: XXX —Ä—É–±."

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ:**
- –°–µ–∫—Ü–∏—è —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏ –ù–ï –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- –ß–µ–∫–±–æ–∫—Å—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –Ω–µ –≤–∏–¥–Ω—ã
- –¢–∞–±–ª–∏—Ü–∞ —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–≥–æ—Ç–æ–≤–∞):**
```html
<div class="mt-4">
    <h6 class="mb-3">–í—ã–±–æ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –¥–ª—è –æ–ø–ª–∞—Ç—ã</h6>
    <div id="noRealizationsHint" class="alert alert-info small" style="display: none;">
        –î–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –Ω–µ—Ç –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π.
    </div>
    <div class="table-responsive" id="realizationSelection" style="display: none;">
        <table class="table table-sm table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th style="width: 40px;"></th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–ù–æ–º–µ—Ä</th>
                    <th>–î–æ–≥–æ–≤–æ—Ä / –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è</th>
                    <th class="text-end">–°—É–º–º–∞</th>
                    <th class="text-end">–û–ø–ª–∞—á–µ–Ω–æ</th>
                    <th class="text-end">–û—Å—Ç–∞—Ç–æ–∫</th>
                </tr>
            </thead>
            <tbody id="realizationsTableBody"></tbody>
        </table>
        <div class="d-flex justify-content-between align-items-center mt-3">
            <div class="text-muted small">
                –í—ã–±—Ä–∞–Ω–æ –∫ –æ–ø–ª–∞—Ç–µ: <span id="selectedTotal">0.00</span> —Ä—É–±.
            </div>
            <div class="text-muted small">
                –û—Å—Ç–∞—Ç–æ–∫ –ø–ª–∞—Ç–µ–∂–∞: <span id="remainingAmount">0.00</span> —Ä—É–±.
            </div>
        </div>
    </div>
</div>
```

**JavaScript-–ª–æ–≥–∏–∫–∞ (–µ—Å—Ç—å, –Ω–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç):**
```javascript
const realizationsData = {{ realizations_json|tojson|safe }};
console.log('Realizations data loaded:', realizationsData);

// –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞:
counterpartySelect.addEventListener('change', function() {
    const selectedCounterpartyId = this.value;
    console.log('Selected counterparty ID:', selectedCounterpartyId);
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤ (—Ä–∞–±–æ—Ç–∞–µ—Ç)
    // ...
    
    renderRealizations(selectedCounterpartyId);  // <-- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
});

function renderRealizations(counterpartyId) {
    console.log('renderRealizations called with ID:', counterpartyId);
    console.log('Realizations for this counterparty:', realizationsData[counterpartyId]);
    
    // –û—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
    realizationsTableBody.innerHTML = '';
    selectedTotalElement.textContent = '0.00';
    remainingAmountElement.textContent = formatRemaining();

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö
    if (!counterpartyId || !realizationsData[counterpartyId] || realizationsData[counterpartyId].length === 0) {
        console.log('No realizations found or empty counterpartyId');
        realizationSection.style.display = 'none';
        noRealizationsHint.style.display = counterpartyId ? '' : 'none';
        return;
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é
    console.log('Showing realizations section');
    noRealizationsHint.style.display = 'none';
    realizationSection.style.display = '';  // <-- –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É, –Ω–æ –ù–ï –†–ê–ë–û–¢–ê–ï–¢

    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
    realizationsData[counterpartyId].forEach(item => {
        // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏
        // ...
    });
}
```

**–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ª–∞–¥–∫–∞:**
- `console.log` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- `console.log` –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞
- `console.log` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `renderRealizations`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- –ö–ª—é—á–∏ –≤ `realizations_payload` –∏–∑–º–µ–Ω–µ–Ω—ã —Å `int` –Ω–∞ `str(counterparty_id)`, —Ç–∞–∫ –∫–∞–∫ JavaScript —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å—Ç—Ä–æ–∫–æ–≤—ã–º–∏ –∫–ª—é—á–∞–º–∏

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Å—Å–∏–∏:**
1. –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/payments`
3. –ù–∞–∂–∞—Ç—å "–ù–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂"
4. –í—ã–±—Ä–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞
5. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏:
   - –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ª–∏ –¥–∞–Ω–Ω—ã–µ `realizationsData`?
   - –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª–∏ —Å–æ–±—ã—Ç–∏–µ `change` –Ω–∞ —Å–µ–ª–µ–∫—Ç–µ?
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `renderRealizations`?
   - –ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ `realizationsData[counterpartyId]`?

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã (–≥–∏–ø–æ—Ç–µ–∑—ã):**
1. **–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ `realizationsData`** ‚Äî –≤—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω—ã –∏–ª–∏ –Ω–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –≤–æ–æ–±—â–µ
2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö** ‚Äî –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ –∫–ª—é—á–µ–π (number vs string) –≤ JavaScript
3. **CSS-–∫–æ–Ω—Ñ–ª–∏–∫—Ç** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, `style="display: none;"` –Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS
4. **–ü—Ä–æ–±–ª–µ–º–∞ —Å `realizationSection.style.display = ''`** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ —è–≤–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `'block'` –∏–ª–∏ `'table-responsive'`
5. **–°–æ–±—ã—Ç–∏—è –Ω–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å `!!counterpartySelect`)

---

## üîÑ –ß–¢–û –û–°–¢–ê–õ–û–°–¨ –°–î–ï–õ–ê–¢–¨

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
- ‚ùå **–û—Ç–ª–∞–¥–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ `realizationsData` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DOM-—ç–ª–µ–º–µ–Ω—Ç—ã
- –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –≤ CSS –∏–ª–∏ Bootstrap –∫–ª–∞—Å—Å–∞—Ö

### 2. –ú–µ—Ö–∞–Ω–∏–∑–º –∑–∞—á—ë—Ç–∞ –∞–≤–∞–Ω—Å–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)
**–ó–∞–¥–∞—á–∞:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–≤–∞–Ω—Å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞.

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –í –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
  - "–£ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –µ—Å—Ç—å –∞–≤–∞–Ω—Å: XXX —Ä—É–±."
  - –ß–µ–∫–±–æ–∫—Å "–ó–∞—á–µ—Å—Ç—å –∞–≤–∞–Ω—Å –≤ —Å—á—ë—Ç —ç—Ç–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞"
- –ü—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—á–∏—Ç—ã–≤–∞—Ç—å –∞–≤–∞–Ω—Å:
  - –°–Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ –∏–∑ –Ω–æ–≤–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
  - –ó–∞—Ç–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ "–¥–æ–∑–∞—á–µ—Å—Ç—å" –∞–≤–∞–Ω—Å—ã (–∏–∑ —Å—Ç–∞—Ä—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π —Å `unallocated_amount > 0`)
- –ü—Ä–∏ –∑–∞—á—ë—Ç–µ –∞–≤–∞–Ω—Å–∞:
  - –£–º–µ–Ω—å—à–∞—Ç—å `unallocated_amount` —É —Å—Ç–∞—Ä–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
  - –î–æ–±–∞–≤–ª—è—Ç—å –∑–∞–ø–∏—Å–∏ –≤ `payment_realization_association`

**–°—Ç–∞—Ç—É—Å:** –ù–µ –Ω–∞—á–∞—Ç–æ, –∂–¥—ë—Ç —Ä–µ—à–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–±–ª–µ–º—ã.

### 3. –û–±–Ω–æ–≤–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ç–∞—Ç—É—Å–æ–≤ –æ–ø–ª–∞—Ç—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3)
**–ó–∞–¥–∞—á–∞:** –£–ª—É—á—à–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –æ–ø–ª–∞—Ç—ã –≤ —Ç–∞–±–ª–∏—Ü–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π.

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –í —Ç–∞–±–ª–∏—Ü–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π (`/realizations`) –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å, –Ω–æ –∏ –¥–µ—Ç–∞–ª–∏:
  - "–û–ø–ª–∞—á–µ–Ω–æ: 5000 –∏–∑ 10000 —Ä—É–±. (50%)"
  - Progress bar –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ:
  - –ö—Ä–∞—Å–Ω—ã–π/–æ—Ä–∞–Ω–∂–µ–≤—ã–π: `NOT_PAID`, `PARTIALLY_PAID`
  - –ó–µ–ª—ë–Ω—ã–π: `PAID`
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Ç–∞—Ç—É—Å ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π, –∫–æ—Ç–æ—Ä—ã–º–∏ –æ–ø–ª–∞—á–µ–Ω–∞ —ç—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–°—Ç–∞—Ç—É—Å:** –ù–µ –Ω–∞—á–∞—Ç–æ.

### 4. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–ª–∞—Ç–µ–∂–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4)
**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/payment/<id>` —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:**
- –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: –¥–∞—Ç–∞, –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç, –¥–æ–≥–æ–≤–æ—Ä, —Å—É–º–º–∞, —Ç–∏–ø
- –¢–∞–±–ª–∏—Ü–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π: –Ω–∞ –∫–∞–∫–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Å–∫–æ–ª—å–∫–æ
- –ù–µ—Ä–∞–∑–Ω–µ—Å—ë–Ω–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ (–∞–≤–∞–Ω—Å)
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å "–¥–æ–≤–Ω–µ—Å—Ç–∏" —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å –∞–≤–∞–Ω—Å)

**–°—Ç–∞—Ç—É—Å:** –ù–µ –Ω–∞—á–∞—Ç–æ.

### 5. –û—Ç—á—ë—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5)
**–ó–∞–¥–∞—á–∞:** –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –æ—Ç—á—ë—Ç–∞–º–∏ –ø–æ –ø–ª–∞—Ç–µ–∂–∞–º –∏ –¥–æ–ª–≥–∞–º.

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –°–≤–æ–¥–∫–∞ –ø–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º:
  - –û–±—â–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å
  - –†–∞–∑–º–µ—Ä –∞–≤–∞–Ω—Å–∞
  - –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- –§–∏–ª—å—Ç—Ä—ã: –ø–æ –ø–µ—Ä–∏–æ–¥—É, –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É, —Å—Ç–∞—Ç—É—Å—É
- –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel

**–°—Ç–∞—Ç—É—Å:** –ù–µ –Ω–∞—á–∞—Ç–æ.

---

## üìù –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–¢–ö–ò –î–õ–Ø –°–õ–ï–î–£–Æ–©–ï–ô –°–ï–°–°–ò–ò

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
1. **–û–¥–∏–Ω –ø–ª–∞—Ç—ë–∂ ‚Üí –º–Ω–æ–≥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π** (many-to-many —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É —Å–≤—è–∑–∏)
2. **–í —Ç–∞–±–ª–∏—Ü–µ —Å–≤—è–∑–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å—É–º–º–∞** —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã –ø–ª–∞—Ç—ë–∂-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
3. **–°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ `paid_amount`
4. **–ê–≤–∞–Ω—Å** = `unallocated_amount` –≤ –º–æ–¥–µ–ª–∏ `Payment`
5. **–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ –≤—Å–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ß—Ç–æ —Ç–æ—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –ë–ï–ó —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (–ø–ª–∞—Ç—ë–∂ —É—Ö–æ–¥–∏—Ç –≤ –∞–≤–∞–Ω—Å)
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –ø–æ–ª–µ–π –ø–ª–∞—Ç–µ–∂–∞
- –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —Å –æ—Ç–∫–∞—Ç–æ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç `debt_amount` –∏ —Å—Ç–∞—Ç—É—Å–æ–≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π

### –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π** ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞!
- –ë–µ–∑ —ç—Ç–æ–≥–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–ª–∞—Ç—ë–∂ –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ UI
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–¥ (`POST /payments`) —Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ –≤ —Ñ–æ—Ä–º–µ –±—É–¥—É—Ç —á–µ–∫–±–æ–∫—Å—ã

### –ö—É–¥–∞ –∫–æ–ø–∞—Ç—å
1. **–°–Ω–∞—á–∞–ª–∞:** –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, —á—Ç–æ –≤—ã–≤–æ–¥—è—Ç `console.log`
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** –ï—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ `realizationsData` –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** –ú–µ–Ω—è–µ—Ç—Å—è –ª–∏ `realizationSection.style.display` –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏
4. **–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `display: 'block'` –≤–º–µ—Å—Ç–æ `display: ''`
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** –ú–æ–∂–µ—Ç, Bootstrap –∫–ª–∞—Å—Å `table-responsive` –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å `display`

### –§–∞–π–ª—ã —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- `models.py` ‚Äî –º–æ–¥–µ–ª–∏ `Payment`, `Realization`, —Ç–∞–±–ª–∏—Ü–∞ —Å–≤—è–∑–∏
- `app.py` ‚Äî –º–∞—Ä—à—Ä—É—Ç—ã `/payments`, `/update-payment/<id>`, `/delete-payment/<id>`
- `templates/payments.html` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º –ø–ª–∞—Ç–µ–∂–µ–π –∏ –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
- `templates/base.html` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ "–ü–ª–∞—Ç–µ–∂–∏" –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—é
- `migrations/versions/5eac254326c8_...py` ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è –ë–î
- `CHANGELOG.md` ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω
- `docs/PAYMENT_SYSTEM_PLAN.md` ‚Äî –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- `docs/PAYMENT_SYSTEM_STATUS.md` ‚Äî —ç—Ç–æ—Ç —Ñ–∞–π–ª (—Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã)

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
```bash
# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
.venv\Scripts\python.exe app.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π
.venv\Scripts\flask.exe db current

# –û—Ç–∫—Ä—ã—Ç—å –ë–î –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–∞–±–ª–∏—Ü—ã: payment, payment_realization_association
```

---

## üéØ –†–ï–ó–Æ–ú–ï

**–û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ 80%:**
- ‚úÖ –ú–æ–¥–µ–ª–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –°–µ—Ä–≤–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- ‚úÖ CRUD –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π (—Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ)
- ‚úÖ UI/UX –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –≤ —Ñ–æ—Ä–º–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞

**–ë–µ–∑ —Ä–µ—à–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ:**
- –†–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø–ª–∞—Ç–µ–∂–∏ –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ UI
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –æ–ø–ª–∞—Ç—ã –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä—ë–º–µ
- –î–≤–∏–≥–∞—Ç—å—Å—è –∫ —Å–ª–µ–¥—É—é—â–∏–º –∑–∞–¥–∞—á–∞–º (–∑–∞—á—ë—Ç –∞–≤–∞–Ω—Å–∞)

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:**
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ ‚Üí –≤—ã–±–æ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π ‚Üí —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤
3. –¢–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –¥–≤–∏–≥–∞—Ç—å—Å—è –∫ –º–µ—Ö–∞–Ω–∏–∑–º—É –∑–∞—á—ë—Ç–∞ –∞–≤–∞–Ω—Å–∞

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:** 30.10.2025, 23:45  
**–°–ª–µ–¥—É—é—â–∞—è —Å–µ—Å—Å–∏—è:** –ù–∞—á–∞—Ç—å —Å –æ—Ç–ª–∞–¥–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

